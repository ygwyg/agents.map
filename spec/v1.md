# AGENTS.map Specification — v1

**Status:** Draft
**Date:** 2026-02-21
**Authors:** Community

---

## 1. Overview

AGENTS.map is an optional repository-root "sitemap" for agent instruction files. It lists where nested `AGENTS.md` files live and provides short descriptions so an agent (or tool) can quickly identify the right subtree before applying the usual cascading discovery rules.

AGENTS.map is **informational, not normative**: the actual rules live in `AGENTS.md`. If AGENTS.map conflicts with an actual `AGENTS.md`, the `AGENTS.md` content wins for that subtree.

## 2. Goals

- Make nested `AGENTS.md` locations **discoverable** without scanning the full tree.
- Provide repo **wayfinding** — "where should I go for X?"
- Stay **low-maintenance** and easy to validate.
- Be **safe to ignore** by tools that don't support it.

## 3. Non-goals

- Replacing existing "nearest `AGENTS.md` applies" semantics.
- Defining the instruction format inside `AGENTS.md`.
- Acting as a comprehensive documentation catalog (unless the repo chooses to).
- Nesting: `AGENTS.map` files MUST only exist at the repository root.

## 4. File Location

### 4.1 Filename

The file MUST be named `AGENTS.map.md` and placed at the repository root.

### 4.2 Format

The file is Markdown. It is both human-readable (renders natively on GitHub, GitLab, etc.) and machine-parseable via simple line-by-line rules described in Section 6.

## 5. Core Semantics

1. Each entry points to an `AGENTS.md` (or tool-recognized equivalent).
2. Entries include a short `purpose` and a `scope` indicating which paths it applies to.
3. If an entry is wrong or stale, tools SHOULD treat it as a **hint** and fall back to normal discovery.
4. **Authority rule:** If AGENTS.map conflicts with an actual `AGENTS.md`, the `AGENTS.md` content wins for that subtree.

## 6. Format: `AGENTS.map.md`

### 6.1 Requirements

`AGENTS.map.md` MUST contain:

1. A title (H1): `# AGENTS.map`
2. A short "how to use" blurb.
3. An `## Entries` section with a list of entries.

### 6.2 Entry Format

Each entry is a Markdown list item with nested sub-items:

```markdown
- Path: /services/payments/AGENTS.md
  - Purpose: Payments domain rules, PCI constraints, test fixtures.
  - Applies to: /services/payments/**
  - Owners: @team-payments
  - Tags: backend, compliance
  - Last reviewed: 2026-02-21
```

### 6.3 Field Definitions

| Field | Required | Description |
|-------|----------|-------------|
| `Path` | Yes | POSIX path relative to repo root, prefixed with `/`. |
| `Purpose` | Yes | 1–3 sentences explaining why/when to use this file. |
| `Applies to` | Yes | Comma-separated glob patterns (e.g., `/services/payments/**`). |
| `Owners` | No | Comma-separated team handles or CODEOWNERS aliases. |
| `Tags` | No | Comma-separated categorical labels (e.g., `backend, security`). |
| `Last reviewed` | No | Date in `YYYY-MM-DD` format. |

### 6.4 Full Example

```markdown
# AGENTS.map

This file lists where nested AGENTS.md files live and what they're for.
The AGENTS.md files themselves are authoritative for their subtrees.

## Entries

- Path: /AGENTS.md
  - Purpose: Global repo conventions, build/test, PR rules.
  - Applies to: /**

- Path: /services/payments/AGENTS.md
  - Purpose: Payments domain rules, PCI constraints, test fixtures.
  - Applies to: /services/payments/**
  - Owners: @team-payments

- Path: /frontend/AGENTS.md
  - Purpose: UI conventions, accessibility checks, component patterns.
  - Applies to: /frontend/**
```

### 6.5 Parsing Rules

Tools parsing `AGENTS.map.md` SHOULD:

1. Look for lines matching `- Path: <path>` to identify entry boundaries.
2. Extract sub-fields from indented `- <Field>: <value>` lines following each Path.
3. Strip leading `/` from paths and scope patterns for internal use.
4. Default `Applies to` to `/**` if not specified.
5. Ignore lines that don't match known field patterns (forward compatibility).

### 6.6 Validation Rules

- Each `Path` SHOULD exist in the repo. CI validation is recommended.
- If an `AGENTS.md` file exists but is not listed, tools MAY still find it via scanning/cascading.
- `Path` values MUST NOT contain `..` segments.
- `Applies to` globs use the same syntax as `.gitignore` patterns.

## 7. Recommended Agent/Tool Algorithm

Given a task that touches one or more **target paths**:

1. **Load the map:** Check for `AGENTS.map.md` at the repository root. Parse it if found.
2. **Match entries:** Identify entries whose `Applies to` globs match the target path(s).
3. **Resolve conflicts:** If multiple entries match, prefer the **most specific scope** (longest matching prefix). If two scopes have equal specificity, load both instruction files.
4. **Load instructions** in this order:
   1. Root `AGENTS.md` (if present and matched).
   2. The most-specific matching subtree `AGENTS.md`.
   3. Apply existing cascading logic toward the working directory (implementation-defined).
5. **Fallback:** If `AGENTS.map.md` is missing or stale, fall back to normal `AGENTS.md` discovery (scan / nearest-parent search).

## 8. Maintenance

Repos SHOULD keep `AGENTS.map.md` in sync via:

- **CI validation** that every listed path exists.
- Optional **discovery script** to find `AGENTS.md` paths automatically, with human-authored purpose fields.
- Periodic review using the `Last reviewed` field.

## 9. Security Considerations

- AGENTS.map exposes repository layout. Avoid listing sensitive or internal-only paths in public repos.
- AGENTS.map MUST be **data-only**. Tools MUST NOT execute anything referenced in the map.
- Tools SHOULD validate that paths do not escape the repository root (no `..`, no absolute filesystem paths).

## 10. Future Considerations

The following are explicitly deferred to future versions:

- **Nested AGENTS.map files** for multi-workspace monorepos.
- **Conditional entries** (e.g., "only applies to Python files in this subtree").
- **Entry priority/weight** for explicit conflict resolution beyond scope specificity.
- **Remote references** (pointing to AGENTS.md files in other repositories).
